<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>
      D&D VTT Maps - Free Virtual Tabletop Battle Maps for FoundryVTT & More
    </title>
    <!--   Usability   -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--  Robots    -->
    <meta name="robots" content="index, follow" />

    <!--  SEO   -->
    <meta
      name="description"
      content="Discover a vast collection of free virtual tabletop maps for Dungeons & Dragons, FoundryVTT, and other VTT software. Elevate your campaigns with stunning, functional battle maps for RPG sessions."
    />
    <meta
      name="keywords"
      content="Dungeons & Dragons, D&D, VTT Maps, FoundryVTT, Battle Maps, Virtual Tabletop, RPG, Free Maps, D&D Maps, Roleplaying Maps, Fantasy Maps"
    />

    <!--  Open Graph Tags for Social Media Sharing  -->
    <meta
      property="og:title"
      content="D&D VTT Maps - Free Virtual Tabletop Battle Maps for FoundryVTT & More!"
    />
    <meta property="og:url" content="https://vtt-maps.dnd-apps.dev/" />
    <meta
      property="og:image"
      content="https://avatars.githubusercontent.com/u/51458697?s=200&v=4"
    />
    <meta
      property="og:description"
      content="Explore our extensive collection of free virtual tabletop maps perfect for Dungeons & Dragons and FoundryVTT. Make your campaign memorable with beautifully crafted RPG maps."
    />
    <meta property="og:type" content="website" />

    <!--  Twitter Card Tags for Social Sharing  -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="D&D VTT Maps - Free Virtual Tabletop Battle Maps for FoundryVTT & More!"
    />
    <meta
      name="twitter:image"
      content="https://avatars.githubusercontent.com/u/51458697?s=200&v=4"
    />
    <meta
      name="twitter:description"
      content="Explore our extensive collection of free virtual tabletop maps perfect for Dungeons & Dragons and FoundryVTT. Make your campaign memorable with beautifully crafted RPG maps."
    />

    <!-- Canonical URL to Prevent Duplicate Content Issues -->
    <link rel="canonical" href="https://vtt-maps.dnd-apps.dev/" />

    <!--  Styles  -->
    <link data-trunk rel="scss" href="./src/styles/index.scss" />

    <!--  Files to Copy  -->
    <link
      data-trunk
      rel="copy-file"
      type="image/x-icon"
      href="../../assets/vtt-maps-logo.png"
    />
    <link data-trunk rel="copy-file" href="../../README.md" />
    <link data-trunk rel="copy-file" href="../../config/CNAME" />
    <link data-trunk rel="copy-dir" href="../../assets" />

    <script defer>
      sessionStorage.setItem("catalog-downloading", JSON.stringify([]));

      function updateQueue(path, action) {
        let queue = JSON.parse(sessionStorage.getItem("catalog-downloading"));
        if (action === "add") {
          queue.push(path);
        } else if (action === "remove") {
          queue = queue.filter((item) => item !== path);
        }
        sessionStorage.setItem("catalog-downloading", JSON.stringify(queue));
      }

      function downloadBlob(blob, filename) {
        const blobUrl = URL.createObjectURL(blob);
        const a = document.createElement("a");

        a.href = blobUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(blobUrl);
      }

      function handleDownload(path, button) {
        console.log(path);

        if (
          JSON.parse(sessionStorage.getItem("catalog-downloading")).includes(
            path,
          )
        ) {
          return;
        }
        const originalText = button.innerHTML;
        // Set loading state with text, for example, "Loading..." instead of using a link element
        button.innerHTML =
          '<img src="../../assets/loading.gif" alt="Loading..." />';
        button.disabled = true; // Disable the button on click
        updateQueue(path, "add");

        fetch(path)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.blob();
          })
          .then((blob) => {
            const fileName = path.split("/").pop();

            downloadBlob(blob, fileName);

            updateQueue(path, "remove");
            button.innerHTML = originalText; // Restore original text
            button.disabled = false; // Re-enable the button after download completes
          })
          .catch(() => {
            updateQueue(path, "remove");
            button.innerHTML = originalText; // Restore original text if an error occurs
            button.disabled = false; // Re-enable the button if an error occurs
          });
      }

      function waitForElementById(id) {
        return new Promise((resolve) => {
          const interval = setInterval(() => {
            if (document.getElementById(id)) {
              clearInterval(interval);
              resolve();
            }
          }, 100);
        });
      }

      async function loader() {
        await waitForElementById("catalog");
        await waitForElementById("map-asset-vcc");
        setTimeout(() => {
          document.querySelectorAll("button[data-href]").forEach((element) => {
            if (!element.hasAttribute("data-processed")) {
              element.setAttribute("data-processed", "true");
              element.onclick = () =>
                handleDownload(element.getAttribute("data-href"), element);
            }
          });
        }, 250);
      }

      loader().then(() => {
        document
          .getElementById("catalog")
          .setAttribute("data-processed", "true");
        document.getElementById("catalog").setAttribute("data-trunk", "true");
        document
          .getElementById("map-asset-vcc")
          .setAttribute("data-trunk", "true");
      });
    </script>
  </head>
  <body></body>
</html>
